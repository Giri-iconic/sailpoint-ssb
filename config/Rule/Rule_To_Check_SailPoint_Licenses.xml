<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE Rule PUBLIC "sailpoint.dtd" "sailpoint.dtd">
<Rule language="beanshell" name="Rule To Check SailPoint Licenses">
  <Source><![CDATA[
 import sailpoint.object.Custom;  
  import sailpoint.object.*;
  import java.math.BigInteger;
  import java.text.SimpleDateFormat;  
  import java.util.Date;  

  log.warn("sailPoint Licenses Start Method");

  Custom customObj = context.getObjectByName(Custom.class, "SailPoint Query");

  //used for to get identity count
  QueryOptions qr=new QueryOptions();
  qr.addFilter(Filter.notnull("name"));
  long totalIdentityCount=context.countObjects(Identity.class,qr);

  //used for to get identity status
  QueryOptions qr=new QueryOptions();
  qr.addFilter(Filter.eq("mglIdentityStatus", "Activated"));
  long activeCount= context.countObjects(Identity.class,qr);
  long totalCount= context.countObjects(Identity.class,null);
  long totalInactiveIdentityAccount=totalCount-activeCount;

  //used for to get identity joining date
  String query = customObj.getString("getAllUserJoiningDate");
  Iterator itr11 = context.search("sql:" + query , null,null);
  Integer lastThirtyCount;
  while(itr11.hasNext()){
    lastThirtyCount=((BigInteger) itr11.next()).intValue();
  }

  Map map=new HashMap();
  map.put("SailPoint Total Identites ",totalIdentityCount);
  map.put("SailPoint Total Licenses",activeCount);
  map.put("SailPoint Inactive Identites",totalInactiveIdentityAccount);
  map.put("User Created In Last 30days",lastThirtyCount);

  log.warn("sailPoint Licenses End Method");
  return map;
  ]]></Source>
</Rule>