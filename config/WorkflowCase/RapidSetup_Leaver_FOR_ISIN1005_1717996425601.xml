<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE WorkflowCase PUBLIC "sailpoint.dtd" "sailpoint.dtd">
<WorkflowCase launcher="Operations" name="RapidSetup Leaver FOR ISIN1005 1717996425601" targetClass="Identity" targetName="ISIN1005">
  <Messages>
    <Message key="Failed to update attribute memberOf Error occurred while setting group membership CN=Domain Users,CN=Users,DC=iconic,DC=com. The server is unwilling to process the request. 0000055E: SvcErr: DSID-031A1260, problem 5003 (WILL_NOT_PERFORM), data 0 . HRESULT:[0x80072035]" type="Error"/>
  </Messages>
  <Workflow currentStep="054be74505994c8cb2130eeee6fb864c" explicitTransitions="true" libraries="RapidSetup" name="RapidSetup - Leaver" type="IdentityLifecycle">
    <Variable input="true" name="trigger"/>
    <Variable input="true" name="event" transient="true"/>
    <Variable input="true" name="identityName"/>
    <Variable initializer="script:Boolean.FALSE" input="true" name="isTerminateIdentity" type="boolean"/>
    <Variable initializer="script:getIdentityProperty(identityName, &quot;manager.name&quot;)" name="identityManager"/>
    <Variable input="true" name="reasonComments"/>
    <Variable editable="true" input="true" name="requestType"/>
    <Variable input="true" name="approvalScheme" output="true"/>
    <Variable initializer="Lifecycle" name="flow"/>
    <Variable initializer="none" input="true" name="policyScheme"/>
    <Variable initializer="none" input="true" name="notificationScheme"/>
    <Variable name="birthrightRoles"/>
    <Variable name="leaverPlanBuilder" transient="true"/>
    <Variable name="immediatePlan" output="true"/>
    <Variable name="deferredPlans" output="true"/>
    <Variable name="project"/>
    <Variable initializer="true" name="saveUnmanagedPlan_WithProjectArgument"/>
    <Variable initializer="RapidSetup" input="true" name="source"/>
    <Variable name="ownershipMap"/>
    <Variable name="identityOwnershipMap"/>
    <Variable name="pamPlans"/>
    <Step complete="true" icon="Start" name="Start" posX="19" posY="8">
      <Transition to="Get Request Type"/>
    </Step>
    <Step action="call:getRequestType" complete="true" name="Get Request Type" posX="133" posY="5" resultVariable="requestType">
      <Arg name="defaultValue" value="leaver"/>
      <Transition to="Remove IdentityIQ Artifacts Ownership"/>
    </Step>
    <Step action="call:reassignOwnership" complete="true" name="Remove IdentityIQ Artifacts Ownership" posX="277" posY="7" resultVariable="ownershipMap">
      <Arg name="identityName" value="ref:identityName"/>
      <Arg name="plan" value="ref:immediatePlan"/>
      <Transition to="Notify IdentityIQ Artifacts Reassignment" when="!(ownershipMap.isEmpty())"/>
      <Transition to="Remove Identity Ownership"/>
    </Step>
    <Step action="sendEmail" icon="Default" name="Notify IdentityIQ Artifacts Reassignment" posX="453" posY="1">
      <Arg name="plan" value="ref:immediatePlan"/>
      <Arg name="ownershipMap" value="ref:ownershipMap"/>
      <Arg name="emailSubject" value="Workitems/Artifacts"/>
      <Arg name="to" value="ref:identityManager"/>
      <Arg name="template">
        <Script>
          <Source>
                
                    if(isTerminateIdentity) {
                        return sailpoint.object.RapidSetupConfigUtils.getString("businessProcesses,terminate,email,ownershipReassignment");
                    } else {
                        return sailpoint.object.RapidSetupConfigUtils.getString("businessProcesses,leaver,email,ownershipReassignment");
                    }
                
            </Source>
        </Script>
      </Arg>
      <Arg name="refIdentityDisplayName">
        <Script>
          <Source>
                
                    sailpoint.rapidsetup.tools.EmailTools.getIdentityDisplayName(context, identityName);
                
            </Source>
        </Script>
      </Arg>
      <Arg name="recipientDisplayName">
        <Script>
          <Source>
                
                    sailpoint.rapidsetup.tools.EmailTools.getIdentityDisplayName(context, identityManager);
                
            </Source>
        </Script>
      </Arg>
      <Transition to="Remove Identity Ownership"/>
    </Step>
    <Step action="call:executeRemoveIdentityOwnership" complete="true" name="Remove Identity Ownership" posX="326" posY="108" resultVariable="identityOwnershipMap">
      <Arg name="identityName" value="ref:identityName"/>
      <Arg name="requestType" value="ref:requestType"/>
      <Arg name="plan" value="ref:immediatePlan"/>
      <Transition to="Notify Identity Owners Reassignment" when="!(identityOwnershipMap.isEmpty())"/>
      <Transition to="Auto Reject Pending Requests"/>
    </Step>
    <Step action="sendEmail" icon="Default" name="Notify Identity Owners Reassignment" posX="556" posY="124">
      <Arg name="plan" value="ref:immediatePlan"/>
      <Arg name="ownershipMap" value="ref:identityOwnershipMap"/>
      <Arg name="emailSubject" value="Identity"/>
      <Arg name="to" value="ref:identityManager"/>
      <Arg name="template">
        <Script>
          <Source>
                
                    if(isTerminateIdentity) {
                        return sailpoint.object.RapidSetupConfigUtils.getString("businessProcesses,terminate,email,ownershipReassignment");
                    } else {
                        return sailpoint.object.RapidSetupConfigUtils.getString("businessProcesses,leaver,email,ownershipReassignment");
                    }
                
            </Source>
        </Script>
      </Arg>
      <Arg name="refIdentityDisplayName">
        <Script>
          <Source>
                
                    sailpoint.rapidsetup.tools.EmailTools.getIdentityDisplayName(context, identityName);
                
            </Source>
        </Script>
      </Arg>
      <Arg name="recipientDisplayName">
        <Script>
          <Source>
                
                    sailpoint.rapidsetup.tools.EmailTools.getIdentityDisplayName(context, identityManager);
                
            </Source>
        </Script>
      </Arg>
      <Transition to="Auto Reject Pending Requests"/>
    </Step>
    <Step action="call:rejectApprovalWorkItems" complete="true" name="Auto Reject Pending Requests" posX="339" posY="202">
      <Arg name="identityName" value="ref:identityName"/>
      <Transition to="Clear Authentication Questions"/>
    </Step>
    <Step action="call:clearAuthenticationQuestionsAndPassword" complete="true" name="Clear Authentication Questions" posX="341" posY="322">
      <Arg name="identityName" value="ref:identityName"/>
      <Transition to="Set Approval Scheme"/>
    </Step>
    <Step action="call:updateApprovalScheme" complete="true" name="Set Approval Scheme" posX="343" posY="415">
      <Arg name="requestType" value="ref:requestType"/>
      <Transition to="Calculate Birthright Roles"/>
    </Step>
    <Step action="call:calculateBirthrightRoles" complete="true" name="Calculate Birthright Roles" posX="414" posY="483" resultVariable="birthrightRoles">
      <Arg name="identityName" value="ref:identityName"/>
      <Transition to="Get Immediate Plan Builder"/>
    </Step>
    <Step action="call:getLeaverPlanBuilder" complete="true" name="Get Immediate Plan Builder" posX="565" posY="482" resultVariable="leaverPlanBuilder">
      <Arg name="birthrightRoles" value="ref:birthrightRoles"/>
      <Arg name="identityName" value="ref:identityName"/>
      <Arg name="requestType" value="ref:requestType"/>
      <Arg name="reasonComments" value="ref:reasonComments"/>
      <Arg name="isTerminateIdentity" value="ref:isTerminateIdentity"/>
      <Transition to="Build Immediate Plan"/>
    </Step>
    <Step complete="true" name="Build Immediate Plan" posX="565" posY="380" resultVariable="immediatePlan">
      <Script>
        <Source>
                
                return leaverPlanBuilder.buildPlan();
                
            </Source>
      </Script>
      <Transition to="Extract Pam Plans"/>
    </Step>
    <Step complete="true" name="Extract Pam Plans" posX="570" posY="257" resultVariable="pamPlans">
      <Arg name="immediatePlan" value="ref:immediatePlan"/>
      <Script>
        <Source>
                
                    return leaverPlanBuilder.extractPamPlans(immediatePlan );
                
            </Source>
      </Script>
      <Transition to="Process Pam Plans"/>
    </Step>
    <Step complete="true" name="Process Pam Plans" posX="706" posY="207">
      <Arg name="pamPlans" value="ref:pamPlans"/>
      <Script>
        <Source>
                
                    return leaverPlanBuilder.processPamPlans(pamPlans, approvalScheme);
                
            </Source>
      </Script>
      <Transition to="Process Plan" when="script:(immediatePlan != null &amp;&amp; !immediatePlan.isEmpty())"/>
      <Transition to="Get Deferred Plan Builder"/>
    </Step>
    <Step name="Process Plan" posX="773" posY="328">
      <Arg name="identityName" value="ref:identityName"/>
      <Arg name="plan" value="ref:immediatePlan"/>
      <Arg name="noTriggers" value="true"/>
      <Arg name="flow" value="ref:flow"/>
      <Arg name="source" value="ref:source"/>
      <Arg name="approvalScheme" value="ref:approvalScheme"/>
      <Arg name="saveUnmanagedPlan_WithProjectArgument" value="ref:saveUnmanagedPlan_WithProjectArgument"/>
      <Arg name="policyScheme" value="ref:policyScheme"/>
      <Arg name="notificationScheme" value="ref:notificationScheme"/>
      <Return name="approvalSet" to="approvalSet"/>
      <Return name="project" to="project"/>
      <WorkflowRef>
        <Reference class="sailpoint.object.Workflow" name="LCM Provisioning"/>
      </WorkflowRef>
      <Transition to="Notify Manager" when="project != null &amp;&amp; project.getPlans() != null &amp;&amp; project.getPlans().size() > 0"/>
      <Transition to="Get Deferred Plan Builder"/>
      <WorkflowCase launcher="Operations" name="LCM Provisioning">
        <Workflow configForm="Provisioning Workflow Config Form" currentStep="65d45910c3de498f84e62e4c8fbe4890" explicitTransitions="true" handler="sailpoint.api.StandardWorkflowHandler" libraries="Identity,Role,PolicyViolation,LCM,BatchRequest" name="LCM Provisioning" taskType="LCM" type="LCMProvisioning">
          <Variable input="true" name="identityName"/>
          <Variable initializer="false" input="true" name="endOnManualWorkItems"/>
          <Variable initializer="false" input="true" name="endOnProvisioningForms"/>
          <Variable initializer="script:(identityDisplayName != void) ? identityDisplayName : resolveDisplayName(identityName)" input="true" name="identityDisplayName"/>
          <Variable input="true" name="plan"/>
          <Variable input="true" name="flow"/>
          <Variable editable="true" initializer="false" name="optimisticProvisioning"/>
          <Variable editable="true" initializer="true" name="foregroundProvisioning"/>
          <Variable input="true" name="batchRequestItemId"/>
          <Variable editable="true" initializer="false" name="doRefresh"/>
          <Variable initializer="user, requester" input="true" name="notificationScheme"/>
          <Variable initializer="LCM User Notification" input="true" name="userEmailTemplate"/>
          <Variable initializer="LCM Requester Notification" input="true" name="requesterEmailTemplate"/>
          <Variable initializer="LCM Manager Notification" input="true" name="managerEmailTemplate"/>
          <Variable input="true" name="securityOfficerEmailTemplate"/>
          <Variable initializer="parallel" input="true" name="approvalMode"/>
          <Variable initializer="none" input="true" name="approvalScheme"/>
          <Variable initializer="LCM Identity Update Approval" input="true" name="approvalEmailTemplate"/>
          <Variable initializer="Normal" input="true" name="workItemPriority"/>
          <Variable input="true" name="securityOfficerName"/>
          <Variable initializer="spadmin" input="true" name="fallbackApprover"/>
          <Variable initializer="continue" input="true" name="policyScheme"/>
          <Variable initializer="false" input="true" name="enableRetryRequest"/>
          <Variable input="true" name="policiesToCheck"/>
          <Variable initializer="LCM" input="true" name="source"/>
          <Variable initializer="false" name="trace"/>
          <Variable name="approvalSet"/>
          <Variable initializer="true" name="allowRequestsWithViolations"/>
          <Variable initializer="true" name="requireViolationReviewComments"/>
          <Variable name="project"/>
          <Variable name="policyViolations"/>
          <Variable name="identityRequestId" output="true"/>
          <Variable name="violationReviewDecision"/>
          <Variable name="workItemComments"/>
          <Variable input="true" name="ticketManagementApplication"/>
          <Variable name="ticketId"/>
          <Variable input="true" name="managerElectronicSignature"/>
          <Variable input="true" name="ownerElectronicSignature"/>
          <Variable input="true" name="securityOfficerElectronicSignature"/>
          <Variable input="true" name="approvingIdentities"/>
          <Variable input="true" name="identityElectronicSignature"/>
          <Variable input="true" name="identityEmailTemplate"/>
          <Variable initializer="true" input="true" name="filterRejects"/>
          <Variable initializer="false" input="true" name="setPreviousApprovalDecisions"/>
          <Variable name="approvalSplitPoint"/>
          <Variable name="splitPlans"/>
          <Variable name="splitProjects"/>
          <Variable name="splitApprovalSet"/>
          <Variable name="splitWorkItemComments"/>
          <Variable initializer="false" input="true" name="saveUnmanagedPlan_WithProjectArgument"/>
          <Variable initializer="false" input="true" name="requireCommentsForApproval"/>
          <Variable initializer="false" input="true" name="requireCommentsForDenial"/>
          <RuleLibraries>
            <Reference class="sailpoint.object.Rule" name="LCM Workflow Library"/>
          </RuleLibraries>
          <Step complete="true" icon="Start" name="Start" posX="25" posY="10">
            <Transition to="Initialize"/>
          </Step>
          <Step complete="true" icon="Task" name="Initialize" posX="134" posY="10">
            <Arg name="formTemplate" value="Identity Update"/>
            <Arg name="identityName" value="ref:identityName"/>
            <Arg name="enableRetryRequest" value="ref:enableRetryRequest"/>
            <Arg name="allowRequestsWithViolations" value="ref:allowRequestsWithViolations"/>
            <Arg name="endOnManualWorkItems" value="ref:endOnManualWorkItems"/>
            <Arg name="policiesToCheck" value="ref:policiesToCheck"/>
            <Arg name="workItemPriority" value="ref:workItemPriority"/>
            <Arg name="source" value="ref:source"/>
            <Arg name="policyScheme" value="ref:policyScheme"/>
            <Arg name="identityDisplayName" value="ref:identityDisplayName"/>
            <Arg name="requireViolationReviewComments" value="ref:requireViolationReviewComments"/>
            <Arg name="identityRequest" value="ref:identityRequest"/>
            <Arg name="trace" value="ref:trace"/>
            <Arg name="batchRequestItemId" value="ref:batchRequestItemId"/>
            <Arg name="enableApprovalRecommendations" value="ref:enableApprovalRecommendations"/>
            <Arg name="asyncCacheRefresh" value="ref:asyncCacheRefresh"/>
            <Arg name="endOnProvisioningForms" value="ref:endOnProvisioningForms"/>
            <Arg name="optimisticProvisioning" value="ref:optimisticProvisioning"/>
            <Arg name="plan" value="ref:plan"/>
            <Arg name="flow" value="ref:flow"/>
            <Arg name="launcher" value="ref:launcher"/>
            <Return name="project" to="project"/>
            <Return name="approvalSet" to="approvalSet"/>
            <Return name="policyViolations" to="policyViolations"/>
            <Return name="identityRequestId" to="identityRequestId"/>
            <Return name="violationReviewDecision" to="violationReviewDecision"/>
            <Return merge="true" name="workItemComments" to="workItemComments"/>
            <WorkflowRef>
              <Reference class="sailpoint.object.Workflow" name="Identity Request Initialize"/>
            </WorkflowRef>
            <Transition to="Exit On Manual Work Items" when="script:(isTrue(endOnManualWorkItems) &amp;&amp; (project.getUnmanagedPlan() != null))"/>
            <Transition to="Exit On Provisioning Form" when="script:(isTrue(endOnProvisioningForms) &amp;&amp; (project.hasQuestions()))"/>
            <Transition to="Exit On Policy Violation">
              <Script>
                <Source>("cancel".equals(violationReviewDecision) || ((size(policyViolations) &gt; 0 ) &amp;&amp; (policyScheme.equals("fail"))))</Source>
              </Script>
            </Transition>
            <Transition to="Create Ticket"/>
          </Step>
          <Step complete="true" condition="script:(ticketManagementApplication != null)" icon="Task" name="Create Ticket" posX="381" posY="6">
            <Arg name="trace" value="ref:trace"/>
            <Arg name="ticketManagementApplication" value="ref:ticketManagementApplication"/>
            <Arg name="project" value="ref:project"/>
            <Arg name="action" value="open"/>
            <Arg name="workItemPriority" value="ref:workItemPriority"/>
            <Arg name="identityRequestId" value="ref:identityRequestId"/>
            <Arg name="source" value="ref:source"/>
            <Arg name="ticketProject" value="ref:ticketProject"/>
            <Arg name="ticketId" value="ref:ticketId"/>
            <Arg name="ticketDataGenerationRule" value="ref:ticketDataGenerationRule"/>
            <Arg name="ticketPlan" value="ref:ticketPlan"/>
            <Return name="ticketId" to="externalTicketId"/>
            <WorkflowRef>
              <Reference class="sailpoint.object.Workflow" name="Manage Ticket"/>
            </WorkflowRef>
            <Transition to="Pre Split Approve" when="script:(!isNull(approvalSplitPoint) &amp;&amp; csvToList(approvalScheme).contains(approvalSplitPoint))"/>
            <Transition to="Approve and Provision"/>
          </Step>
          <Step condition="script:((flow == null) ||  (!&quot;UnlockAccount&quot;.equals(flow)))" icon="Task" name="Pre Split Approve" posX="518" posY="63">
            <Arg name="approvalScheme">
              <Script>
                <Source>
              import java.util.List;
              import java.util.ArrayList;
              import java.util.Iterator;
              import sailpoint.tools.Util;

              List schemes = Util.csvToList(approvalScheme);
              List preSchemes = new ArrayList&lt;String&gt;();
              for (String s : Util.safeIterable(schemes)) {
                if (s.equals(approvalSplitPoint)) {
                    break;
                } else {
                    preSchemes.add(s);
                }
              }
              return Util.listToCsv(preSchemes);
          </Source>
              </Script>
            </Arg>
            <Arg name="identityEmailTemplate" value="ref:identityEmailTemplate"/>
            <Arg name="securityOfficerElectronicSignature" value="ref:securityOfficerElectronicSignature"/>
            <Arg name="fallbackApprover" value="ref:fallbackApprover"/>
            <Arg name="workItemHoursBetweenReminders"/>
            <Arg name="workItemPriority" value="ref:workItemPriority"/>
            <Arg name="project" value="ref:project"/>
            <Arg name="workItemComments"/>
            <Arg name="identityRequestId" value="ref:identityRequestId"/>
            <Arg name="approvalSplitPoint" value="ref:approvalSplitPoint"/>
            <Arg name="managerElectronicSignature" value="ref:managerElectronicSignature"/>
            <Arg name="workItemDescription"/>
            <Arg name="identityDisplayName" value="ref:identityDisplayName"/>
            <Arg name="ownerElectronicSignature" value="ref:ownerElectronicSignature"/>
            <Arg name="approvalMode" value="ref:approvalMode"/>
            <Arg name="trace" value="ref:trace"/>
            <Arg name="dontUpdatePlan"/>
            <Arg name="workItemEscalationRule"/>
            <Arg name="approvalAssignmentRule"/>
            <Arg name="plan" value="ref:plan"/>
            <Arg name="flow" value="ref:flow"/>
            <Arg name="requireCommentsForApproval" value="ref:requireCommentsForApproval"/>
            <Arg name="identityElectronicSignature" value="ref:identityElectronicSignature"/>
            <Arg name="identityName" value="ref:identityName"/>
            <Arg name="approvalSet" value="ref:approvalSet"/>
            <Arg name="policyViolations" value="ref:policyViolations"/>
            <Arg name="ownerEmailTemplate" value="ref:approvalEmailTemplate"/>
            <Arg name="filterRejects" value="ref:filterRejects"/>
            <Arg name="workItemReminderTemplate"/>
            <Arg name="workItemEscalationTemplate"/>
            <Arg name="setPreviousApprovalDecisions" value="ref:setPreviousApprovalDecisions"/>
            <Arg name="clearApprovalDecisions"/>
            <Arg name="noTriggers"/>
            <Arg name="workItemMaxReminders"/>
            <Arg name="requireCommentsForDenial" value="ref:requireCommentsForDenial"/>
            <Arg name="approvingIdentities" value="ref:approvingIdentities"/>
            <Arg name="securityOfficerEmailTemplate" value="ref:approvalEmailTemplate"/>
            <Arg name="securityOfficerName" value="ref:securityOfficerName"/>
            <Arg name="workItemHoursTillEscalation"/>
            <Arg name="managerEmailTemplate" value="ref:approvalEmailTemplate"/>
            <Arg name="launcher" value="ref:launcher"/>
            <Return name="approvalSet"/>
            <Return name="workItemComments"/>
            <Return name="project"/>
            <WorkflowRef>
              <Reference class="sailpoint.object.Workflow" name="Provisioning Approval Subprocess"/>
            </WorkflowRef>
            <Transition to="Split Plan"/>
          </Step>
          <Step action="call:splitProvisioningPlan" icon="Task" name="Split Plan" posX="618" posY="63" resultVariable="splitPlans">
            <Arg name="project" value="ref:project"/>
            <Transition to="Approve and Provision Split"/>
          </Step>
          <Step icon="Task" name="Approve and Provision Split" posX="783" posY="63">
            <Arg name="formTemplate" value="Identity Update"/>
            <Arg name="identityEmailTemplate" value="ref:identityEmailTemplate"/>
            <Arg name="enableRetryRequest" value="ref:enableRetryRequest"/>
            <Arg name="securityOfficerElectronicSignature" value="ref:securityOfficerElectronicSignature"/>
            <Arg name="fallbackApprover" value="ref:fallbackApprover"/>
            <Arg name="endOnManualWorkItems" value="ref:endOnManualWorkItems"/>
            <Arg name="userEmailTemplate" value="ref:userEmailTemplate"/>
            <Arg name="project" value="ref:project"/>
            <Arg name="workItemComments" value="ref:workItemComments"/>
            <Arg name="identityRequestId" value="ref:identityRequestId"/>
            <Arg name="approvalSplitPoint" value="ref:approvalSplitPoint"/>
            <Arg name="source" value="ref:source"/>
            <Arg name="identityDisplayName" value="ref:identityDisplayName"/>
            <Arg name="foregroundProvisioning" value="ref:foregroundProvisioning"/>
            <Arg name="ownerElectronicSignature" value="ref:ownerElectronicSignature"/>
            <Arg name="batchRequestItemId" value="ref:batchRequestItemId"/>
            <Arg name="saveUnmanagedPlan_WithProjectArgument" value="ref:saveUnmanagedPlan_WithProjectArgument"/>
            <Arg name="plan" value="ref:plan"/>
            <Arg name="flow" value="ref:flow"/>
            <Arg name="identityElectronicSignature" value="ref:identityElectronicSignature"/>
            <Arg name="identityName" value="ref:identityName"/>
            <Arg name="approvalSet" value="ref:approvalSet"/>
            <Arg name="filterRejects" value="ref:filterRejects"/>
            <Arg name="ownerEmailTemplate" value="ref:approvalEmailTemplate"/>
            <Arg name="splitProvisioning" value="true"/>
            <Arg name="workItemEscalationTemplate" value="ref:workItemEscalationTemplate"/>
            <Arg name="clearApprovalDecisions"/>
            <Arg name="noTriggers"/>
            <Arg name="requireCommentsForDenial" value="ref:requireCommentsForDenial"/>
            <Arg name="workItemMaxReminders" value="ref:workItemMaxReminders"/>
            <Arg name="requesterEmailTemplate" value="ref:requesterEmailTemplate"/>
            <Arg name="approvalEmailTemplate" value="ref:approvalEmailTemplate"/>
            <Arg name="ticketManagementApplication" value="ref:ticketManagementApplication"/>
            <Arg name="securityOfficerName" value="ref:securityOfficerName"/>
            <Arg name="approvingIdentities" value="ref:approvingIdentities"/>
            <Arg name="workItemHoursTillEscalation" value="ref:workItemHoursTillEscalation"/>
            <Arg name="managerEmailTemplate" value="ref:approvalEmailTemplate"/>
            <Arg name="launcher" value="ref:launcher"/>
            <Arg name="approvalScheme">
              <Script>
                <Source>
              import java.util.List;
              import java.util.Iterator;
              import sailpoint.tools.Util;
              List schemes = Util.csvToList(approvalScheme);
              Iterator it = schemes.iterator();
              while (it.hasNext()) {
                String s = it.next();
                if (!s.equals(approvalSplitPoint)) {
                    it.remove();
                } else {
                    break;
                }
              }
              return Util.listToCsv(schemes);
            </Source>
              </Script>
            </Arg>
            <Arg name="workItemHoursBetweenReminders" value="ref:workItemHoursBetweenReminders"/>
            <Arg name="workItemPriority" value="ref:workItemPriority"/>
            <Arg name="managerElectronicSignature" value="ref:managerElectronicSignature"/>
            <Arg name="approvalMode" value="ref:approvalMode"/>
            <Arg name="trace" value="ref:trace"/>
            <Arg name="workItemEscalationRule" value="ref:workItemEscalationRule"/>
            <Arg name="endOnProvisioningForms" value="ref:endOnProvisioningForms"/>
            <Arg name="approvalAssignmentRule"/>
            <Arg name="requireCommentsForApproval" value="ref:requireCommentsForApproval"/>
            <Arg name="manualActionsEmailTemplate" value="Pending Manual Changes"/>
            <Arg name="policyViolations" value="ref:policyViolations"/>
            <Arg name="policyScheme" value="ref:policyScheme"/>
            <Arg name="workItemReminderTemplate" value="ref:workItemReminderTemplate"/>
            <Arg name="setPreviousApprovalDecisions" value="ref:setPreviousApprovalDecisions"/>
            <Arg name="optimisticProvisioning" value="ref:optimisticProvisioning"/>
            <Arg name="securityOfficerEmailTemplate" value="ref:approvalEmailTemplate"/>
            <Replicator arg="plan" items="splitPlans"/>
            <Return name="project" to="splitProjects"/>
            <Return name="workItemComments" to="splitWorkItemComments"/>
            <Return name="approvalSet" to="splitApprovalSet"/>
            <WorkflowRef>
              <Reference class="sailpoint.object.Workflow" name="Approve and Provision Subprocess"/>
            </WorkflowRef>
            <Transition to="Assimilate Splits"/>
          </Step>
          <Step action="call:joinLCMProvWorkflowSplits" icon="Task" name="Assimilate Splits" posX="914" posY="63">
            <Arg name="splitProjects" value="ref:splitProjects"/>
            <Arg name="splitApprovalSet" value="ref:splitApprovalSet"/>
            <Arg name="splitWorkItemComments" value="ref:splitWorkItemComments"/>
            <Transition to="Refresh Identity"/>
          </Step>
          <Step icon="Task" name="Approve and Provision" posX="699" posY="7">
            <Arg name="formTemplate" value="Identity Update"/>
            <Arg name="identityEmailTemplate" value="ref:identityEmailTemplate"/>
            <Arg name="enableRetryRequest" value="ref:enableRetryRequest"/>
            <Arg name="securityOfficerElectronicSignature" value="ref:securityOfficerElectronicSignature"/>
            <Arg name="fallbackApprover" value="ref:fallbackApprover"/>
            <Arg name="endOnManualWorkItems" value="ref:endOnManualWorkItems"/>
            <Arg name="userEmailTemplate" value="ref:userEmailTemplate"/>
            <Arg name="project" value="ref:project"/>
            <Arg name="workItemComments" value="ref:workItemComments"/>
            <Arg name="identityRequestId" value="ref:identityRequestId"/>
            <Arg name="approvalSplitPoint" value="ref:approvalSplitPoint"/>
            <Arg name="source" value="ref:source"/>
            <Arg name="identityDisplayName" value="ref:identityDisplayName"/>
            <Arg name="foregroundProvisioning" value="ref:foregroundProvisioning"/>
            <Arg name="ownerElectronicSignature" value="ref:ownerElectronicSignature"/>
            <Arg name="batchRequestItemId" value="ref:batchRequestItemId"/>
            <Arg name="saveUnmanagedPlan_WithProjectArgument" value="ref:saveUnmanagedPlan_WithProjectArgument"/>
            <Arg name="plan" value="ref:plan"/>
            <Arg name="flow" value="ref:flow"/>
            <Arg name="identityElectronicSignature" value="ref:identityElectronicSignature"/>
            <Arg name="identityName" value="ref:identityName"/>
            <Arg name="approvalSet" value="ref:approvalSet"/>
            <Arg name="filterRejects" value="ref:filterRejects"/>
            <Arg name="ownerEmailTemplate" value="ref:approvalEmailTemplate"/>
            <Arg name="splitProvisioning" value="false"/>
            <Arg name="workItemEscalationTemplate" value="ref:workItemEscalationTemplate"/>
            <Arg name="clearApprovalDecisions" value="ref:clearApprovalDecisions"/>
            <Arg name="noTriggers" value="ref:noTriggers"/>
            <Arg name="requireCommentsForDenial" value="ref:requireCommentsForDenial"/>
            <Arg name="workItemMaxReminders" value="ref:workItemMaxReminders"/>
            <Arg name="requesterEmailTemplate" value="ref:requesterEmailTemplate"/>
            <Arg name="approvalEmailTemplate" value="ref:approvalEmailTemplate"/>
            <Arg name="ticketManagementApplication" value="ref:ticketManagementApplication"/>
            <Arg name="securityOfficerName" value="ref:securityOfficerName"/>
            <Arg name="approvingIdentities" value="ref:approvingIdentities"/>
            <Arg name="workItemHoursTillEscalation" value="ref:workItemHoursTillEscalation"/>
            <Arg name="managerEmailTemplate" value="ref:approvalEmailTemplate"/>
            <Arg name="launcher" value="ref:launcher"/>
            <Arg name="approvalScheme" value="ref:approvalScheme"/>
            <Arg name="workItemHoursBetweenReminders" value="ref:workItemHoursBetweenReminders"/>
            <Arg name="workItemPriority" value="ref:workItemPriority"/>
            <Arg name="managerElectronicSignature" value="ref:managerElectronicSignature"/>
            <Arg name="approvalMode" value="ref:approvalMode"/>
            <Arg name="trace" value="ref:trace"/>
            <Arg name="workItemEscalationRule" value="ref:workItemEscalationRule"/>
            <Arg name="endOnProvisioningForms" value="ref:endOnProvisioningForms"/>
            <Arg name="approvalAssignmentRule" value="ref:approvalAssignmentRule"/>
            <Arg name="requireCommentsForApproval" value="ref:requireCommentsForApproval"/>
            <Arg name="manualActionsEmailTemplate" value="Pending Manual Changes"/>
            <Arg name="policyViolations" value="ref:policyViolations"/>
            <Arg name="policyScheme" value="ref:policyScheme"/>
            <Arg name="workItemReminderTemplate" value="ref:workItemReminderTemplate"/>
            <Arg name="setPreviousApprovalDecisions" value="ref:setPreviousApprovalDecisions"/>
            <Arg name="optimisticProvisioning" value="ref:optimisticProvisioning"/>
            <Arg name="securityOfficerEmailTemplate" value="ref:approvalEmailTemplate"/>
            <Return name="project" to="project"/>
            <Return name="approvalSet" to="approvalSet"/>
            <Return name="workItemComments" to="workItemComments"/>
            <WorkflowRef>
              <Reference class="sailpoint.object.Workflow" name="Approve and Provision Subprocess"/>
            </WorkflowRef>
            <Transition to="Refresh Identity"/>
            <WorkflowCase launcher="Operations" name="Approve and Provision Subprocess">
              <Workflow currentStep="4fc4738b43ca42029ec00bc164204cf9" explicitTransitions="true" name="Approve and Provision Subprocess" type="Subprocess">
                <Variable input="true" name="identityName"/>
                <Variable initializer="false" input="true" name="endOnManualWorkItems"/>
                <Variable initializer="false" input="true" name="endOnProvisioningForms"/>
                <Variable initializer="script:(identityDisplayName != void) ? identityDisplayName : resolveDisplayName(identityName)" input="true" name="identityDisplayName"/>
                <Variable input="true" name="plan"/>
                <Variable input="true" name="noTriggers"/>
                <Variable input="true" name="flow"/>
                <Variable editable="true" initializer="false" name="optimisticProvisioning"/>
                <Variable editable="true" initializer="true" name="foregroundProvisioning"/>
                <Variable input="true" name="batchRequestItemId"/>
                <Variable initializer="LCM User Notification" input="true" name="userEmailTemplate"/>
                <Variable initializer="LCM Requester Notification" input="true" name="requesterEmailTemplate"/>
                <Variable initializer="LCM Manager Notification" input="true" name="managerEmailTemplate"/>
                <Variable input="true" name="securityOfficerEmailTemplate"/>
                <Variable initializer="parallel" input="true" name="approvalMode"/>
                <Variable initializer="owner" input="true" name="approvalScheme"/>
                <Variable initializer="LCM Identity Update Approval" input="true" name="approvalEmailTemplate"/>
                <Variable initializer="Normal" input="true" name="workItemPriority"/>
                <Variable input="true" name="securityOfficerName"/>
                <Variable initializer="spadmin" input="true" name="fallbackApprover"/>
                <Variable initializer="false" input="true" name="enableRetryRequest"/>
                <Variable initializer="LCM" input="true" name="source"/>
                <Variable initializer="false" name="trace"/>
                <Variable name="approvalSet"/>
                <Variable input="true" name="approvalAssignmentRule"/>
                <Variable name="project"/>
                <Variable name="policyViolations"/>
                <Variable name="identityRequestId" output="true"/>
                <Variable name="workItemComments"/>
                <Variable input="true" name="ticketManagementApplication"/>
                <Variable input="true" name="managerElectronicSignature"/>
                <Variable input="true" name="ownerElectronicSignature"/>
                <Variable input="true" name="securityOfficerElectronicSignature"/>
                <Variable initializer="true" input="true" name="filterRejects"/>
                <Variable initializer="false" input="true" name="setPreviousApprovalDecisions"/>
                <Variable input="true" name="approvalSplitPoint"/>
                <Variable input="true" name="clearApprovalDecisions"/>
                <Variable input="true" name="approvingIdentities"/>
                <Variable input="true" name="formTemplate"/>
                <Variable input="true" name="manualActionsEmailTemplate"/>
                <Variable initializer="LCM Identity Update Approval" input="true" name="ownerEmailTemplate"/>
                <Variable initializer="false" input="true" name="splitProvisioning"/>
                <Variable initializer="false" input="true" name="saveUnmanagedPlan_WithProjectArgument"/>
                <Variable initializer="false" input="true" name="requireCommentsForApproval"/>
                <Variable initializer="false" input="true" name="requireCommentsForDenial"/>
                <RuleLibraries>
                  <Reference class="sailpoint.object.Rule" name="LCM Workflow Library"/>
                </RuleLibraries>
                <Step complete="true" icon="Start" name="Start" posX="20" posY="20">
                  <Transition to="Compile Project"/>
                </Step>
                <Step action="call:compileProvisioningProject" complete="true" condition="script:(!approvalScheme.equalsIgnoreCase(&quot;none&quot;) &amp;&amp; !isNull(approvalSplitPoint))" icon="Task" name="Compile Project" posX="120" posY="20" resultVariable="project">
                  <Arg name="identityName" value="ref:identityName"/>
                  <Arg name="plan" value="ref:plan"/>
                  <Arg name="requester" value="ref:launcher"/>
                  <Arg name="source" value="ref:source"/>
                  <Arg name="optimisticProvisioning" value="ref:optimisticProvisioning"/>
                  <Arg name="disableRetryRequest" value="!ref:enableRetryRequest"/>
                  <Arg name="noApplicationTemplates">
                    <Script>
                      <Source>
                    boolean ignoreForms = false;
                    if ("ForgotPassword".equals(flow) || "ExpirePassword".equals(flow)) {
                    ignoreForms = true;
                    }
                    return ignoreForms;
                </Source>
                    </Script>
                  </Arg>
                  <Transition to="Build Approval Set"/>
                </Step>
                <Step action="call:buildSplitApprovalSet" complete="true" condition="script:(!approvalScheme.equalsIgnoreCase(&quot;none&quot;) &amp;&amp; !isNull(approvalSplitPoint))" icon="Task" name="Build Approval Set" posX="220" posY="20" resultVariable="approvalSet">
                  <Arg name="plan" value="ref:plan"/>
                  <Return name="approvalSet" to="approvalSet"/>
                  <Transition to="Approve"/>
                </Step>
                <Step complete="true" condition="script:((flow == null) ||  (!&quot;UnlockAccount&quot;.equals(flow)))" configForm="Provisioning Approval Step Form" icon="Approval" name="Approve" posX="320" posY="20">
                  <Arg name="approvalMode" value="ref:approvalMode"/>
                  <Arg name="approvalScheme" value="ref:approvalScheme"/>
                  <Arg name="approvalSet" value="ref:approvalSet"/>
                  <Arg name="approvalSplitPoint" value="ref:approvalSplitPoint"/>
                  <Arg name="approvalAssignmentRule" value="ref:approvalAssignmentRule"/>
                  <Arg name="approvingIdentities" value="ref:approvingIdentities"/>
                  <Arg name="fallbackApprover" value="ref:fallbackApprover"/>
                  <Arg name="filterRejects" value="ref:filterRejects"/>
                  <Arg name="flow" value="ref:flow"/>
                  <Arg name="identityName" value="ref:identityName"/>
                  <Arg name="identityDisplayName" value="ref:identityDisplayName"/>
                  <Arg name="identityElectronicSignature" value="ref:identityElectronicSignature"/>
                  <Arg name="identityEmailTemplate" value="ref:identityEmailTemplate"/>
                  <Arg name="identityRequestId" value="ref:identityRequestId"/>
                  <Arg name="launcher" value="ref:launcher"/>
                  <Arg name="managerEmailTemplate" value="ref:approvalEmailTemplate"/>
                  <Arg name="managerElectronicSignature" value="ref:managerElectronicSignature"/>
                  <Arg name="ownerEmailTemplate" value="ref:approvalEmailTemplate"/>
                  <Arg name="ownerElectronicSignature" value="ref:ownerElectronicSignature"/>
                  <Arg name="project" value="ref:project"/>
                  <Arg name="plan" value="ref:plan"/>
                  <Arg name="policyViolations" value="ref:policyViolations"/>
                  <Arg name="workItemPriority" value="ref:workItemPriority"/>
                  <Arg name="securityOfficerName" value="ref:securityOfficerName"/>
                  <Arg name="securityOfficerEmailTemplate" value="ref:approvalEmailTemplate"/>
                  <Arg name="securityOfficerElectronicSignature" value="ref:securityOfficerElectronicSignature"/>
                  <Arg name="setPreviousApprovalDecisions" value="ref:setPreviousApprovalDecisions"/>
                  <Arg name="trace" value="ref:trace"/>
                  <Arg name="workItemReminderTemplate" value="ref:workItemReminderTemplate"/>
                  <Arg name="workItemHoursBetweenReminders" value="ref:workItemHoursBetweenReminders"/>
                  <Arg name="workItemMaxReminders" value="ref:workItemMaxReminders"/>
                  <Arg name="workItemEscalationTemplate" value="ref:workItemEscalationTemplate"/>
                  <Arg name="workItemHoursTillEscalation" value="ref:workItemHoursTillEscalation"/>
                  <Arg name="workItemEscalationRule" value="ref:workItemEscalationRule"/>
                  <Arg name="workItemComments" value="ref:workItemComments"/>
                  <Arg name="clearApprovalDecisions" value="script:(!isNull(approvalSplitPoint) &amp;&amp; csvToList(approvalScheme).contains(approvalSplitPoint))"/>
                  <Return name="approvalSet"/>
                  <Return name="workItemComments"/>
                  <Return name="project"/>
                  <WorkflowRef>
                    <Reference class="sailpoint.object.Workflow" name="Provisioning Approval Subprocess"/>
                  </WorkflowRef>
                  <Transition to="Update Ticket Post Approval"/>
                </Step>
                <Step complete="true" condition="script:(ticketManagementApplication != null)" icon="Task" name="Update Ticket Post Approval" posX="470" posY="20">
                  <Arg name="action" value="postApproval"/>
                  <Arg name="workItemPriority" value="ref:workItemPriority"/>
                  <Arg name="project" value="ref:project"/>
                  <Arg name="source" value="ref:source"/>
                  <Arg name="ticketManagementApplication" value="ref:ticketManagementApplication"/>
                  <Arg name="identityRequestId" value="ref:identityRequestId"/>
                  <Arg name="ticketDataGenerationRule" value=""/>
                  <Arg name="trace" value="ref:trace"/>
                  <WorkflowRef>
                    <Reference class="sailpoint.object.Workflow" name="Manage Ticket"/>
                  </WorkflowRef>
                  <Transition to="Provision"/>
                </Step>
                <Step icon="Provision" name="Provision" posX="600" posY="20">
                  <Arg name="approvalScheme" value="ref:approvalScheme"/>
                  <Arg name="approvalSet" value="ref:approvalSet"/>
                  <Arg name="fallbackApprover" value="ref:fallbackApprover"/>
                  <Arg name="foregroundProvisioning" value="ref:foregroundProvisioning"/>
                  <Arg name="formTemplate" value="Identity Update"/>
                  <Arg name="flow" value="ref:flow"/>
                  <Arg name="identityDisplayName" value="ref:identityDisplayName"/>
                  <Arg name="identityName" value="ref:identityName"/>
                  <Arg name="identityRequestId" value="ref:identityRequestId"/>
                  <Arg name="launcher" value="ref:launcher"/>
                  <Arg name="manualActionsEmailTemplate" value="Pending Manual Changes"/>
                  <Arg name="noTriggers" value="ref:noTriggers"/>
                  <Arg name="optimisticProvisioning" value="ref:optimisticProvisioning"/>
                  <Arg name="policyViolations" value="ref:policyViolations"/>
                  <Arg name="project" value="ref:project"/>
                  <Arg name="policyScheme" value="ref:policyScheme"/>
                  <Arg name="workItemPriority" value="ref:workItemPriority"/>
                  <Arg name="trace" value="ref:trace"/>
                  <Arg name="workItemComments" value="ref:workItemComments"/>
                  <Arg name="splitProvisioning" value="ref:splitProvisioning"/>
                  <Arg name="saveUnmanagedPlan_WithProjectArgument" value="ref:saveUnmanagedPlan_WithProjectArgument"/>
                  <Return name="project" to="project"/>
                  <WorkflowRef>
                    <Reference class="sailpoint.object.Workflow" name="Identity Request Provision"/>
                  </WorkflowRef>
                  <Transition to="Update Ticket Post Provision"/>
                  <WorkflowCase launcher="Operations" name="Identity Request Provision">
                    <Messages>
                      <Message key="Modifications to Test2.Tes2t are being provisioned." type="Info"/>
                    </Messages>
                    <Workflow currentStep="1b912384a7b34fb3a3c81f43b32f2150" libraries="Identity,IdentityRequest" name="Identity Request Provision" type="Subprocess">
                      <Variable editable="true" initializer="false" input="true" name="optimisticProvisioning"/>
                      <Variable editable="true" initializer="true" input="true" name="foregroundProvisioning"/>
                      <Variable input="true" name="fallbackApprover" required="true"/>
                      <Variable input="true" name="approvalSet"/>
                      <Variable initializer="Identity Update" input="true" name="formTemplate"/>
                      <Variable input="true" name="trace"/>
                      <Variable input="true" name="plan"/>
                      <Variable initializer="true" input="true" name="recompile"/>
                      <Variable initializer="Pending Manual Changes" input="true" name="manualActionsEmailTemplate"/>
                      <Variable input="true" name="noTriggers"/>
                      <Variable input="true" name="workItemComments"/>
                      <Variable input="true" name="approvalScheme"/>
                      <Variable input="true" name="identityRequestId"/>
                      <Variable input="true" name="workItemPriority"/>
                      <Variable input="true" name="splitProvisioning"/>
                      <Variable initializer="true" input="true" name="saveUnmanagedPlan"/>
                      <Variable initializer="false" input="true" name="saveUnmanagedPlan_WithProjectArgument"/>
                      <Variable input="true" name="project" output="true"/>
                      <Variable name="retries"/>
                      <RuleLibraries>
                        <Reference class="sailpoint.object.Rule" name="LCM Workflow Library"/>
                      </RuleLibraries>
                      <Step complete="true" icon="Start" name="Start" posX="15" posY="12">
                        <Transition to="Start Provisioning Process"/>
                      </Step>
                      <Step action="call:addMessage" complete="true" icon="Message" name="Start Provisioning Process" posX="130" posY="12">
                        <Arg name="message" value="Modifications to $(identityDisplayName) are being provisioned."/>
                        <Transition to="Process Approval Decisions"/>
                      </Step>
                      <Step action="call:processApprovalDecisions" complete="true" condition="script:!isNull(approvalSet)" icon="Task" name="Process Approval Decisions" posX="309" posY="11" resultVariable="project">
                        <Arg name="project" value="ref:project"/>
                        <Arg name="plan" value="ref:plan"/>
                        <Arg name="approvalSet" value="ref:approvalSet"/>
                        <Arg name="recompile" value="ref:recompile"/>
                        <Arg name="disableAudit" value="true"/>
                        <Transition to="Do Provisioning Forms Post-Approval"/>
                      </Step>
                      <Step complete="true" icon="Task" name="Do Provisioning Forms Post-Approval" posX="511" posY="12">
                        <Arg name="approvalSet" value="ref:approvalSet"/>
                        <Arg name="identityName" value="ref:identityName"/>
                        <Arg name="identityDisplayName" value="ref:identityDisplayName"/>
                        <Arg name="project" value="ref:project"/>
                        <Arg name="workItemPriority" value="ref:workItemPriority"/>
                        <Arg name="formTemplate" value="ref:formTemplate"/>
                        <Arg name="preferredOwner" value="ref:sessionOwner"/>
                        <Return name="project" to="project"/>
                        <Return name="approvalSet" to="approvalSet"/>
                        <WorkflowRef>
                          <Reference class="sailpoint.object.Workflow" name="Do Provisioning Forms"/>
                        </WorkflowRef>
                        <Transition to="Pre Provision"/>
                      </Step>
                      <Step action="call:assimilateAccountIdChanges" complete="true" icon="Task" name="Pre Provision" posX="682" posY="13" resultVariable="approvalSet">
                        <Arg name="approvalSet" value="ref:approvalSet"/>
                        <Arg name="project" value="ref:project"/>
                        <Arg name="identityRequestId" value="ref:identityRequestId"/>
                        <Transition to="Refresh Identity Request"/>
                      </Step>
                      <Step action="call:refreshIdentityRequestAfterApproval" complete="true" icon="Task" name="Refresh Identity Request" posX="813" posY="13">
                        <Arg name="project" value="ref:project"/>
                        <Arg name="splitProvisioning" value="ref:splitProvisioning"/>
                        <Transition to="Provision"/>
                      </Step>
                      <Step complete="true" icon="Task" name="Provision" posX="941" posY="13">
                        <Arg name="project" value="ref:project"/>
                        <Arg name="foregroundProvisioning" value="ref:foregroundProvisioning"/>
                        <Arg name="trace" value="ref:trace"/>
                        <Arg name="noTriggers" value="ref:noTriggers"/>
                        <Arg name="identityRequestId" value="ref:identityRequestId"/>
                        <Arg name="splitProvisioning" value="ref:splitProvisioning"/>
                        <Arg name="recompileBeforeProvisioning" value="!ref:foregroundProvisioning"/>
                        <Return name="retries" to="retries"/>
                        <Return name="project" to="project"/>
                        <WorkflowRef>
                          <Reference class="sailpoint.object.Workflow" name="Provision with retries"/>
                        </WorkflowRef>
                        <Transition to="Wait for Queued Items"/>
                      </Step>
                      <Step complete="true" icon="Task" name="Wait for Queued Items" posX="1074" posY="13">
                        <Arg name="project" value="ref:project"/>
                        <Arg name="splitProvisioning" value="ref:splitProvisioning"/>
                        <Arg name="trace" value="ref:trace"/>
                        <Return name="project" to="project"/>
                        <WorkflowRef>
                          <Reference class="sailpoint.object.Workflow" name="Check Status of queued items"/>
                        </WorkflowRef>
                        <Transition to="Post Provision"/>
                      </Step>
                      <Step complete="true" icon="Task" name="Post Provision" posX="1205" posY="13">
                        <Script>
                          <Source>
        import sailpoint.api.ObjectUtil;
        import sailpoint.tools.Util;
        import sailpoint.object.ProvisioningProject;

        if ( approvalSet != null ) {
            // Set state to pending
            approvalSet.initializeProvisioningState();
            if ( Util.otob(trace) ) {
                 System.out.println("ApprovalSet:\n" + approvalSet.toXml());
            }
        }
        if ( project != null ) {
            if ( Util.otob(trace) ) {
                 // clone and scrub the project so passwords are not visible
                 ProvisioningProject clonedProject = project.deepCopy(wfcontext.getSailPointContext());
                 ObjectUtil.scrubPasswords(clonedProject);
                 System.out.println("Project Executed in identitiy:\n" + clonedProject.toXml());
            }
        }
      </Source>
                        </Script>
                        <Transition to="Manual Actions"/>
                      </Step>
                      <Step condition="script:project.getUnmanagedPlan() != null" icon="Approval" name="Manual Actions" posX="1316" posY="13">
                        <Approval mode="parallelPoll" originalOwner="rule:Build Manual Action Approvals" renderer="lcmManualActionsRenderer.xhtml" send="identityDisplayName,identityName,policyViolations" started="true">
                          <AfterScript>
                            <Source>
          
          import sailpoint.object.ApprovalSet;
          import sailpoint.object.ApprovalItem;
          import sailpoint.object.WorkItem;
          import sailpoint.object.WorkItem;
          import sailpoint.workflow.IdentityRequestLibrary;
          import sailpoint.workflow.IdentityLibrary;
          import sailpoint.tools.Util;

          if (item == null) {
              // must not be a leaf approval...
              return;
          }

          // mark all of the items finished once the item is complete
          ApprovalSet set = (ApprovalSet)item.get("approvalSet");
          if ( set != null ) {
              List approvalItems = set.getItems();
              for ( ApprovalItem approvalItem : approvalItems ) {
                  approvalItem.setState(WorkItem.State.Finished);
                  // update identity request provisioning state
                  IdentityRequestLibrary.updateIdentityRequestItemProvisioningState(approvalItem, wfcontext);
              }
          }
          
          //save unmanaged plan as ProvisioningRequest
          if ( Util.otob(saveUnmanagedPlan) ) {
              if( ( Util.otob(saveUnmanagedPlan_WithProjectArgument) ) &amp;&amp; ( project != null ) ) {
                  IdentityLibrary.saveUnmanagedPlan(wfcontext, project);
              } else {
                  IdentityLibrary.saveUnmanagedPlan(wfcontext);
              }
          }
          
          // Audit the manual change
          auditManualAction(item);
          
        </Source>
                          </AfterScript>
                          <Arg name="project" value="ref:project"/>
                          <Arg name="workItemRequester" value="$(launcher)"/>
                          <Arg name="workItemDescription" value="Manual Changes requested for User: $(identityDisplayName)"/>
                          <Arg name="workItemPriority" value="ref:workItemPriority"/>
                          <Arg name="workItemType" value="ManualAction"/>
                          <Arg name="workItemNotificationTemplate" value="ref:manualActionsEmailTemplate"/>
                          <Arg name="saveUnmanagedPlan_WithProjectArgument" value="ref:saveUnmanagedPlan_WithProjectArgument"/>
                          <Approval originalOwner="&quot;spadmin&quot;" owner="spadmin" startDate="1717996430460" started="true" workItemDescription="Manual Changes requested for User: Test2.Tes2t" workItemId="0a00030f90001de781900091244300ba" workItemType="ManualAction">
                            <ApprovalSet>
                              <ApprovalItem application="HRMS" nativeIdentity="ISIN1005" operation="Disable">
                                <Attributes>
                                  <Map>
                                    <entry key="flow" value="Lifecycle"/>
                                    <entry key="interface" value="LCM"/>
                                    <entry key="operation" value="Disable"/>
                                  </Map>
                                </Attributes>
                              </ApprovalItem>
                            </ApprovalSet>
                            <Arg name="workItemTargetClass" value="sailpoint.object.Identity"/>
                            <Arg name="workItemTargetName" value="ISIN1005"/>
                          </Approval>
                        </Approval>
                        <Transition to="end"/>
                      </Step>
                      <Step icon="Stop" name="end" posX="1419" posY="13"/>
                      <Attributes>
                        <Map>
                          <entry key="approvalScheme" value="none"/>
                          <entry key="approvalSet">
                            <value>
                              <ApprovalSet>
                                <ApprovalItem application="Active Directory" displayValue="ICONIC\Domain Users" name="memberOf" nativeIdentity="cn=Test2.Tes2t,ou=Test,dc=iconic,dc=com" operation="Remove" value="CN=Domain Users,CN=Users,DC=iconic,DC=com"/>
                                <ApprovalItem application="Active Directory" nativeIdentity="cn=Test2.Tes2t,ou=Test,dc=iconic,dc=com" operation="Disable">
                                  <Attributes>
                                    <Map>
                                      <entry key="flow" value="Lifecycle"/>
                                      <entry key="interface" value="LCM"/>
                                      <entry key="operation" value="Disable"/>
                                    </Map>
                                  </Attributes>
                                </ApprovalItem>
                                <ApprovalItem application="HRMS" nativeIdentity="ISIN1005" operation="Disable">
                                  <Attributes>
                                    <Map>
                                      <entry key="flow" value="Lifecycle"/>
                                      <entry key="interface" value="LCM"/>
                                      <entry key="operation" value="Disable"/>
                                    </Map>
                                  </Attributes>
                                </ApprovalItem>
                              </ApprovalSet>
                            </value>
                          </entry>
                          <entry key="fallbackApprover" value="spadmin"/>
                          <entry key="flow" value="Lifecycle"/>
                          <entry key="foregroundProvisioning" value="true"/>
                          <entry key="formTemplate" value="Identity Update"/>
                          <entry key="identityDisplayName" value="Test2.Tes2t"/>
                          <entry key="identityName" value="ISIN1005"/>
                          <entry key="identityRequestId" value="0000000048"/>
                          <entry key="launcher" value="Operations"/>
                          <entry key="manualActionsEmailTemplate" value="Pending Manual Changes"/>
                          <entry key="noTriggers" value="true"/>
                          <entry key="optimisticProvisioning" value="false"/>
                          <entry key="plan"/>
                          <entry key="policyScheme" value="none"/>
                          <entry key="project">
                            <value>
                              <ProvisioningProject identity="ISIN1005">
                                <Attributes>
                                  <Map>
                                    <entry key="disableRetryRequest">
                                      <value>
                                        <Boolean>true</Boolean>
                                      </value>
                                    </entry>
                                    <entry key="identityRequestId" value="0000000048"/>
                                    <entry key="noLocking">
                                      <value>
                                        <Boolean>true</Boolean>
                                      </value>
                                    </entry>
                                    <entry key="optimisticProvisioning" value="false"/>
                                    <entry key="requester" value="Operations"/>
                                    <entry key="source" value="RapidSetup"/>
                                  </Map>
                                </Attributes>
                                <MasterPlan>
                                  <ProvisioningPlan>
                                    <AccountRequest application="Active Directory" nativeIdentity="cn=Test2.Tes2t,ou=Test,dc=iconic,dc=com" op="Modify">
                                      <AttributeRequest displayValue="ICONIC\Domain Users" name="memberOf" op="Remove" value="CN=Domain Users,CN=Users,DC=iconic,DC=com">
                                        <Attributes>
                                          <Map>
                                            <entry key="assignment" value="true"/>
                                          </Map>
                                        </Attributes>
                                      </AttributeRequest>
                                    </AccountRequest>
                                    <AccountRequest application="Active Directory" nativeIdentity="cn=Test2.Tes2t,ou=Test,dc=iconic,dc=com" op="Disable">
                                      <Attributes>
                                        <Map>
                                          <entry key="flow" value="Lifecycle"/>
                                          <entry key="interface" value="LCM"/>
                                          <entry key="operation" value="Disable"/>
                                        </Map>
                                      </Attributes>
                                    </AccountRequest>
                                    <AccountRequest application="HRMS" nativeIdentity="ISIN1005" op="Disable">
                                      <Attributes>
                                        <Map>
                                          <entry key="flow" value="Lifecycle"/>
                                          <entry key="interface" value="LCM"/>
                                          <entry key="operation" value="Disable"/>
                                        </Map>
                                      </Attributes>
                                    </AccountRequest>
                                    <Attributes>
                                      <Map>
                                        <entry key="identityRequestId" value="0000000048"/>
                                        <entry key="requester" value="Operations"/>
                                        <entry key="source" value="RapidSetup"/>
                                      </Map>
                                    </Attributes>
                                    <Requesters>
                                      <Reference class="sailpoint.object.Identity" name="Operations"/>
                                    </Requesters>
                                  </ProvisioningPlan>
                                </MasterPlan>
                                <ProvisioningPlan nativeIdentity="ISIN1005" targetIntegration="Active Directory" trackingId="6c31b1bb1fb74f2d98ab85ca22de6228">
                                  <AccountRequest application="Active Directory" nativeIdentity="cn=Test2.Tes2t,ou=Test,dc=iconic,dc=com" op="Disable" targetIntegration="Active Directory">
                                    <Attributes>
                                      <Map>
                                        <entry key="flow" value="Lifecycle"/>
                                        <entry key="interface" value="LCM"/>
                                        <entry key="operation" value="Disable"/>
                                        <entry key="provisioningTransactionId" value="0a00030f90001de781900091233f00b9"/>
                                      </Map>
                                    </Attributes>
                                    <AttributeRequest displayValue="ICONIC\Domain Users" name="memberOf" op="Remove" value="CN=Domain Users,CN=Users,DC=iconic,DC=com">
                                      <Attributes>
                                        <Map>
                                          <entry key="assignment" value="true"/>
                                        </Map>
                                      </Attributes>
                                      <ProvisioningResult status="failed">
                                        <Errors>
                                          <Message key="Failed to update attribute memberOf Error occurred while setting group membership CN=Domain Users,CN=Users,DC=iconic,DC=com. The server is unwilling to process the request. 0000055E: SvcErr: DSID-031A1260, problem 5003 (WILL_NOT_PERFORM), data 0 . HRESULT:[0x80072035]" type="Error"/>
                                        </Errors>
                                      </ProvisioningResult>
                                    </AttributeRequest>
                                    <ProvisioningResult status="committed"/>
                                  </AccountRequest>
                                  <Attributes>
                                    <Map>
                                      <entry key="identityRequestId" value="0000000048"/>
                                      <entry key="requester" value="Operations"/>
                                      <entry key="source" value="RapidSetup"/>
                                    </Map>
                                  </Attributes>
                                  <Requesters>
                                    <Reference class="sailpoint.object.Identity" name="Operations"/>
                                  </Requesters>
                                </ProvisioningPlan>
                                <ProvisioningPlan trackingId="2d6ad149dbb745c5a921052defbc8606">
                                  <AccountRequest application="HRMS" nativeIdentity="ISIN1005" op="Disable">
                                    <Attributes>
                                      <Map>
                                        <entry key="flow" value="Lifecycle"/>
                                        <entry key="interface" value="LCM"/>
                                        <entry key="operation" value="Disable"/>
                                      </Map>
                                    </Attributes>
                                  </AccountRequest>
                                  <Attributes>
                                    <Map>
                                      <entry key="identityRequestId" value="0000000048"/>
                                      <entry key="requester" value="Operations"/>
                                      <entry key="source" value="RapidSetup"/>
                                    </Map>
                                  </Attributes>
                                  <Requesters>
                                    <Reference class="sailpoint.object.Identity" name="Operations"/>
                                  </Requesters>
                                </ProvisioningPlan>
                              </ProvisioningProject>
                            </value>
                          </entry>
                          <entry key="recompile" value="true"/>
                          <entry key="retries">
                            <value>
                              <Integer>0</Integer>
                            </value>
                          </entry>
                          <entry key="saveUnmanagedPlan" value="true"/>
                          <entry key="saveUnmanagedPlan_WithProjectArgument" value="true"/>
                          <entry key="sessionOwner" value="Operations"/>
                          <entry key="splitProvisioning" value="false"/>
                          <entry key="workItemComments"/>
                          <entry key="workItemPriority" value="Normal"/>
                        </Map>
                      </Attributes>
                    </Workflow>
                  </WorkflowCase>
                </Step>
                <Step condition="script:(ticketManagementApplication != null)" icon="Task" name="Update Ticket Post Provision" posX="700" posY="20">
                  <Arg name="action" value="postProvisioning"/>
                  <Arg name="source" value="ref:source"/>
                  <Arg name="workItemPriority" value="ref:workItemPriority"/>
                  <Arg name="project" value="ref:project"/>
                  <Arg name="ticketManagementApplication" value="ref:ticketManagementApplication"/>
                  <Arg name="identityRequestId" value="ref:identityRequestId"/>
                  <Arg name="ticketDataGenerationRule" value=""/>
                  <Arg name="trace" value="ref:trace"/>
                  <WorkflowRef>
                    <Reference class="sailpoint.object.Workflow" name="Manage Ticket"/>
                  </WorkflowRef>
                </Step>
                <Attributes>
                  <Map>
                    <entry key="approvalAssignmentRule"/>
                    <entry key="approvalEmailTemplate" value="LCM Identity Update Approval"/>
                    <entry key="approvalMode" value="parallel"/>
                    <entry key="approvalScheme" value="none"/>
                    <entry key="approvalSet">
                      <value>
                        <ApprovalSet>
                          <ApprovalItem application="Active Directory" displayValue="ICONIC\Domain Users" name="memberOf" nativeIdentity="cn=Test2.Tes2t,ou=Test,dc=iconic,dc=com" operation="Remove" value="CN=Domain Users,CN=Users,DC=iconic,DC=com"/>
                          <ApprovalItem application="Active Directory" nativeIdentity="cn=Test2.Tes2t,ou=Test,dc=iconic,dc=com" operation="Disable">
                            <Attributes>
                              <Map>
                                <entry key="flow" value="Lifecycle"/>
                                <entry key="interface" value="LCM"/>
                                <entry key="operation" value="Disable"/>
                              </Map>
                            </Attributes>
                          </ApprovalItem>
                          <ApprovalItem application="HRMS" nativeIdentity="ISIN1005" operation="Disable">
                            <Attributes>
                              <Map>
                                <entry key="flow" value="Lifecycle"/>
                                <entry key="interface" value="LCM"/>
                                <entry key="operation" value="Disable"/>
                              </Map>
                            </Attributes>
                          </ApprovalItem>
                        </ApprovalSet>
                      </value>
                    </entry>
                    <entry key="approvalSplitPoint"/>
                    <entry key="approvingIdentities"/>
                    <entry key="batchRequestItemId"/>
                    <entry key="clearApprovalDecisions"/>
                    <entry key="enableRetryRequest" value="false"/>
                    <entry key="endOnManualWorkItems" value="false"/>
                    <entry key="endOnProvisioningForms" value="false"/>
                    <entry key="fallbackApprover" value="spadmin"/>
                    <entry key="filterRejects" value="true"/>
                    <entry key="flow" value="Lifecycle"/>
                    <entry key="foregroundProvisioning" value="true"/>
                    <entry key="formTemplate" value="Identity Update"/>
                    <entry key="identityDisplayName" value="Test2.Tes2t"/>
                    <entry key="identityName" value="ISIN1005"/>
                    <entry key="identityRequestId" value="0000000048"/>
                    <entry key="launcher" value="Operations"/>
                    <entry key="managerElectronicSignature"/>
                    <entry key="managerEmailTemplate" value="LCM Identity Update Approval"/>
                    <entry key="manualActionsEmailTemplate" value="Pending Manual Changes"/>
                    <entry key="noTriggers" value="true"/>
                    <entry key="optimisticProvisioning" value="false"/>
                    <entry key="ownerElectronicSignature"/>
                    <entry key="ownerEmailTemplate" value="LCM Identity Update Approval"/>
                    <entry key="plan">
                      <value>
                        <ProvisioningPlan>
                          <AccountRequest application="Active Directory" nativeIdentity="cn=Test2.Tes2t,ou=Test,dc=iconic,dc=com" op="Modify">
                            <AttributeRequest displayValue="ICONIC\Domain Users" name="memberOf" op="Remove" value="CN=Domain Users,CN=Users,DC=iconic,DC=com">
                              <Attributes>
                                <Map>
                                  <entry key="assignment" value="true"/>
                                </Map>
                              </Attributes>
                            </AttributeRequest>
                          </AccountRequest>
                          <AccountRequest application="Active Directory" nativeIdentity="cn=Test2.Tes2t,ou=Test,dc=iconic,dc=com" op="Disable">
                            <Attributes>
                              <Map>
                                <entry key="flow" value="Lifecycle"/>
                                <entry key="interface" value="LCM"/>
                                <entry key="operation" value="Disable"/>
                              </Map>
                            </Attributes>
                          </AccountRequest>
                          <AccountRequest application="HRMS" nativeIdentity="ISIN1005" op="Disable">
                            <Attributes>
                              <Map>
                                <entry key="flow" value="Lifecycle"/>
                                <entry key="interface" value="LCM"/>
                                <entry key="operation" value="Disable"/>
                              </Map>
                            </Attributes>
                          </AccountRequest>
                          <Attributes>
                            <Map>
                              <entry key="identityRequestId" value="0000000048"/>
                              <entry key="requester" value="Operations"/>
                              <entry key="source" value="RapidSetup"/>
                            </Map>
                          </Attributes>
                          <Requesters>
                            <Reference class="sailpoint.object.Identity" name="Operations"/>
                          </Requesters>
                        </ProvisioningPlan>
                      </value>
                    </entry>
                    <entry key="policyScheme" value="none"/>
                    <entry key="policyViolations"/>
                    <entry key="project">
                      <value>
                        <ProvisioningProject identity="ISIN1005">
                          <Attributes>
                            <Map>
                              <entry key="disableRetryRequest">
                                <value>
                                  <Boolean>true</Boolean>
                                </value>
                              </entry>
                              <entry key="identityRequestId" value="0000000048"/>
                              <entry key="noLocking">
                                <value>
                                  <Boolean>true</Boolean>
                                </value>
                              </entry>
                              <entry key="optimisticProvisioning" value="false"/>
                              <entry key="requester" value="Operations"/>
                              <entry key="source" value="RapidSetup"/>
                            </Map>
                          </Attributes>
                          <MasterPlan>
                            <ProvisioningPlan>
                              <AccountRequest application="Active Directory" nativeIdentity="cn=Test2.Tes2t,ou=Test,dc=iconic,dc=com" op="Modify">
                                <AttributeRequest displayValue="ICONIC\Domain Users" name="memberOf" op="Remove" value="CN=Domain Users,CN=Users,DC=iconic,DC=com">
                                  <Attributes>
                                    <Map>
                                      <entry key="assignment" value="true"/>
                                    </Map>
                                  </Attributes>
                                </AttributeRequest>
                              </AccountRequest>
                              <AccountRequest application="Active Directory" nativeIdentity="cn=Test2.Tes2t,ou=Test,dc=iconic,dc=com" op="Disable">
                                <Attributes>
                                  <Map>
                                    <entry key="flow" value="Lifecycle"/>
                                    <entry key="interface" value="LCM"/>
                                    <entry key="operation" value="Disable"/>
                                  </Map>
                                </Attributes>
                              </AccountRequest>
                              <AccountRequest application="HRMS" nativeIdentity="ISIN1005" op="Disable">
                                <Attributes>
                                  <Map>
                                    <entry key="flow" value="Lifecycle"/>
                                    <entry key="interface" value="LCM"/>
                                    <entry key="operation" value="Disable"/>
                                  </Map>
                                </Attributes>
                              </AccountRequest>
                              <Attributes>
                                <Map>
                                  <entry key="identityRequestId" value="0000000048"/>
                                  <entry key="requester" value="Operations"/>
                                  <entry key="source" value="RapidSetup"/>
                                </Map>
                              </Attributes>
                              <Requesters>
                                <Reference class="sailpoint.object.Identity" name="Operations"/>
                              </Requesters>
                            </ProvisioningPlan>
                          </MasterPlan>
                          <ProvisioningPlan nativeIdentity="ISIN1005" targetIntegration="Active Directory" trackingId="6c31b1bb1fb74f2d98ab85ca22de6228">
                            <AccountRequest application="Active Directory" nativeIdentity="cn=Test2.Tes2t,ou=Test,dc=iconic,dc=com" op="Disable" targetIntegration="Active Directory">
                              <Attributes>
                                <Map>
                                  <entry key="flow" value="Lifecycle"/>
                                  <entry key="interface" value="LCM"/>
                                  <entry key="operation" value="Disable"/>
                                  <entry key="provisioningTransactionId" value="0a00030f90001de781900091233f00b9"/>
                                </Map>
                              </Attributes>
                              <AttributeRequest displayValue="ICONIC\Domain Users" name="memberOf" op="Remove" value="CN=Domain Users,CN=Users,DC=iconic,DC=com">
                                <Attributes>
                                  <Map>
                                    <entry key="assignment" value="true"/>
                                  </Map>
                                </Attributes>
                                <ProvisioningResult status="failed">
                                  <Errors>
                                    <Message key="Failed to update attribute memberOf Error occurred while setting group membership CN=Domain Users,CN=Users,DC=iconic,DC=com. The server is unwilling to process the request. 0000055E: SvcErr: DSID-031A1260, problem 5003 (WILL_NOT_PERFORM), data 0 . HRESULT:[0x80072035]" type="Error"/>
                                  </Errors>
                                </ProvisioningResult>
                              </AttributeRequest>
                              <ProvisioningResult status="committed"/>
                            </AccountRequest>
                            <Attributes>
                              <Map>
                                <entry key="identityRequestId" value="0000000048"/>
                                <entry key="requester" value="Operations"/>
                                <entry key="source" value="RapidSetup"/>
                              </Map>
                            </Attributes>
                            <Requesters>
                              <Reference class="sailpoint.object.Identity" name="Operations"/>
                            </Requesters>
                          </ProvisioningPlan>
                          <ProvisioningPlan trackingId="2d6ad149dbb745c5a921052defbc8606">
                            <AccountRequest application="HRMS" nativeIdentity="ISIN1005" op="Disable">
                              <Attributes>
                                <Map>
                                  <entry key="flow" value="Lifecycle"/>
                                  <entry key="interface" value="LCM"/>
                                  <entry key="operation" value="Disable"/>
                                </Map>
                              </Attributes>
                            </AccountRequest>
                            <Attributes>
                              <Map>
                                <entry key="identityRequestId" value="0000000048"/>
                                <entry key="requester" value="Operations"/>
                                <entry key="source" value="RapidSetup"/>
                              </Map>
                            </Attributes>
                            <Requesters>
                              <Reference class="sailpoint.object.Identity" name="Operations"/>
                            </Requesters>
                          </ProvisioningPlan>
                        </ProvisioningProject>
                      </value>
                    </entry>
                    <entry key="requesterEmailTemplate" value="LCM Requester Notification"/>
                    <entry key="requireCommentsForApproval" value="false"/>
                    <entry key="requireCommentsForDenial" value="false"/>
                    <entry key="saveUnmanagedPlan_WithProjectArgument" value="true"/>
                    <entry key="securityOfficerElectronicSignature"/>
                    <entry key="securityOfficerEmailTemplate" value="LCM Identity Update Approval"/>
                    <entry key="securityOfficerName"/>
                    <entry key="sessionOwner" value="Operations"/>
                    <entry key="setPreviousApprovalDecisions" value="false"/>
                    <entry key="source" value="RapidSetup"/>
                    <entry key="splitProvisioning" value="false"/>
                    <entry key="ticketManagementApplication"/>
                    <entry key="userEmailTemplate" value="LCM User Notification"/>
                    <entry key="workItemComments"/>
                    <entry key="workItemPriority" value="Normal"/>
                  </Map>
                </Attributes>
              </Workflow>
            </WorkflowCase>
          </Step>
          <Step action="call:refreshIdentity" condition="ref:doRefresh" icon="Task" name="Refresh Identity" posX="1028" posY="7">
            <Arg name="identityName" value="ref:identityName"/>
            <Arg name="correlateEntitlements" value="true"/>
            <Transition to="Notify"/>
          </Step>
          <Step icon="Task" name="Notify" posX="1131" posY="7">
            <Arg name="approvalScheme" value="ref:approvalScheme"/>
            <Arg name="identityName" value="ref:identityName"/>
            <Arg name="notificationScheme" value="ref:notificationScheme"/>
            <Arg name="userEmailTemplate" value="ref:userEmailTemplate"/>
            <Arg name="approvalSet" value="ref:approvalSet"/>
            <Arg name="policyViolations" value="ref:policyViolations"/>
            <Arg name="workItemPriority" value="ref:workItemPriority"/>
            <Arg name="source" value="ref:source"/>
            <Arg name="identityDisplayName" value="ref:identityDisplayName"/>
            <Arg name="trace" value="ref:trace"/>
            <Arg name="requesterEmailTemplate" value="ref:requesterEmailTemplate"/>
            <Arg name="securityOfficerName" value="ref:securityOfficerName"/>
            <Arg name="securityOfficerEmailTemplate" value="ref:securityOfficerEmailTemplate"/>
            <Arg name="plan" value="ref:plan"/>
            <Arg name="flow" value="ref:flow"/>
            <Arg name="managerEmailTemplate" value="ref:managerEmailTemplate"/>
            <Arg name="launcher" value="ref:launcher"/>
            <WorkflowRef>
              <Reference class="sailpoint.object.Workflow" name="Identity Request Notify"/>
            </WorkflowRef>
            <Transition to="end"/>
          </Step>
          <Step action="call:addMessage" name="Exit On Policy Violation" posX="201" posY="253">
            <Arg name="message" value="Failed due to policy violation(s)"/>
            <Arg name="type" value="Error"/>
            <Transition to="end"/>
          </Step>
          <Step action="call:addMessage" name="Exit On Manual Work Items" posX="364" posY="107">
            <Arg name="message" value="Failed due to manual work item(s)"/>
            <Arg name="type" value="Error"/>
            <Transition to="end"/>
          </Step>
          <Step action="call:addMessage" name="Exit On Provisioning Form" posX="280" posY="178">
            <Arg name="message" value="Failed due to provisioning form"/>
            <Arg name="type" value="Error"/>
            <Transition to="end"/>
          </Step>
          <Step catches="complete" icon="Catches" name="Finalize" posX="1058" posY="308">
            <Arg name="trace" value="ref:trace"/>
            <Arg name="batchRequestItemId" value="ref:batchRequestItemId"/>
            <Arg name="identityName" value="ref:identityName"/>
            <Arg name="autoVerifyIdentityRequest"/>
            <Arg name="approvalSet" value="ref:approvalSet"/>
            <Arg name="ticketManagementApplication" value="ref:ticketManagementApplication"/>
            <Arg name="project" value="ref:project"/>
            <Arg name="workItemPriority" value="ref:workItemPriority"/>
            <Arg name="identityRequestId" value="ref:identityRequestId"/>
            <Arg name="ticketDataGenerationRule"/>
            <WorkflowRef>
              <Reference class="sailpoint.object.Workflow" name="Identity Request Finalize"/>
            </WorkflowRef>
            <Transition to="end"/>
          </Step>
          <Step icon="Stop" name="end" posX="1131" posY="253"/>
          <Attributes>
            <Map>
              <entry key="allowRequestsWithViolations" value="true"/>
              <entry key="approvalEmailTemplate" value="LCM Identity Update Approval"/>
              <entry key="approvalMode" value="parallel"/>
              <entry key="approvalScheme" value="none"/>
              <entry key="approvalSet">
                <value>
                  <ApprovalSet>
                    <ApprovalItem application="Active Directory" displayValue="ICONIC\Domain Users" name="memberOf" nativeIdentity="cn=Test2.Tes2t,ou=Test,dc=iconic,dc=com" operation="Remove" value="CN=Domain Users,CN=Users,DC=iconic,DC=com"/>
                    <ApprovalItem application="Active Directory" nativeIdentity="cn=Test2.Tes2t,ou=Test,dc=iconic,dc=com" operation="Disable">
                      <Attributes>
                        <Map>
                          <entry key="flow" value="Lifecycle"/>
                          <entry key="interface" value="LCM"/>
                          <entry key="operation" value="Disable"/>
                        </Map>
                      </Attributes>
                    </ApprovalItem>
                    <ApprovalItem application="HRMS" nativeIdentity="ISIN1005" operation="Disable">
                      <Attributes>
                        <Map>
                          <entry key="flow" value="Lifecycle"/>
                          <entry key="interface" value="LCM"/>
                          <entry key="operation" value="Disable"/>
                        </Map>
                      </Attributes>
                    </ApprovalItem>
                  </ApprovalSet>
                </value>
              </entry>
              <entry key="approvalSplitPoint"/>
              <entry key="approvingIdentities"/>
              <entry key="batchRequestItemId"/>
              <entry key="doRefresh" value="false"/>
              <entry key="enableRetryRequest" value="false"/>
              <entry key="endOnManualWorkItems" value="false"/>
              <entry key="endOnProvisioningForms" value="false"/>
              <entry key="fallbackApprover" value="spadmin"/>
              <entry key="filterRejects" value="true"/>
              <entry key="flow" value="Lifecycle"/>
              <entry key="foregroundProvisioning" value="true"/>
              <entry key="identityDisplayName" value="Test2.Tes2t"/>
              <entry key="identityElectronicSignature"/>
              <entry key="identityEmailTemplate"/>
              <entry key="identityName" value="ISIN1005"/>
              <entry key="identityRequestId" value="0000000048"/>
              <entry key="launcher" value="Operations"/>
              <entry key="managerElectronicSignature"/>
              <entry key="managerEmailTemplate" value="LCM Manager Notification"/>
              <entry key="noTriggers" value="true"/>
              <entry key="notificationScheme" value="none"/>
              <entry key="optimisticProvisioning" value="false"/>
              <entry key="ownerElectronicSignature"/>
              <entry key="plan">
                <value>
                  <ProvisioningPlan>
                    <AccountRequest application="Active Directory" nativeIdentity="cn=Test2.Tes2t,ou=Test,dc=iconic,dc=com" op="Modify">
                      <AttributeRequest displayValue="ICONIC\Domain Users" name="memberOf" op="Remove" value="CN=Domain Users,CN=Users,DC=iconic,DC=com">
                        <Attributes>
                          <Map>
                            <entry key="assignment" value="true"/>
                          </Map>
                        </Attributes>
                      </AttributeRequest>
                    </AccountRequest>
                    <AccountRequest application="Active Directory" nativeIdentity="cn=Test2.Tes2t,ou=Test,dc=iconic,dc=com" op="Disable">
                      <Attributes>
                        <Map>
                          <entry key="flow" value="Lifecycle"/>
                          <entry key="interface" value="LCM"/>
                          <entry key="operation" value="Disable"/>
                        </Map>
                      </Attributes>
                    </AccountRequest>
                    <AccountRequest application="HRMS" nativeIdentity="ISIN1005" op="Disable">
                      <Attributes>
                        <Map>
                          <entry key="flow" value="Lifecycle"/>
                          <entry key="interface" value="LCM"/>
                          <entry key="operation" value="Disable"/>
                        </Map>
                      </Attributes>
                    </AccountRequest>
                    <Attributes>
                      <Map>
                        <entry key="identityRequestId" value="0000000048"/>
                        <entry key="requester" value="Operations"/>
                        <entry key="source" value="RapidSetup"/>
                      </Map>
                    </Attributes>
                    <Requesters>
                      <Reference class="sailpoint.object.Identity" name="Operations"/>
                    </Requesters>
                  </ProvisioningPlan>
                </value>
              </entry>
              <entry key="policiesToCheck"/>
              <entry key="policyScheme" value="none"/>
              <entry key="policyViolations"/>
              <entry key="project">
                <value>
                  <ProvisioningProject identity="ISIN1005">
                    <Attributes>
                      <Map>
                        <entry key="disableRetryRequest">
                          <value>
                            <Boolean>true</Boolean>
                          </value>
                        </entry>
                        <entry key="identityRequestId" value="0000000048"/>
                        <entry key="noLocking">
                          <value>
                            <Boolean>true</Boolean>
                          </value>
                        </entry>
                        <entry key="optimisticProvisioning" value="false"/>
                        <entry key="requester" value="Operations"/>
                        <entry key="source" value="RapidSetup"/>
                      </Map>
                    </Attributes>
                    <MasterPlan>
                      <ProvisioningPlan>
                        <AccountRequest application="Active Directory" nativeIdentity="cn=Test2.Tes2t,ou=Test,dc=iconic,dc=com" op="Modify">
                          <AttributeRequest displayValue="ICONIC\Domain Users" name="memberOf" op="Remove" value="CN=Domain Users,CN=Users,DC=iconic,DC=com">
                            <Attributes>
                              <Map>
                                <entry key="assignment" value="true"/>
                              </Map>
                            </Attributes>
                          </AttributeRequest>
                        </AccountRequest>
                        <AccountRequest application="Active Directory" nativeIdentity="cn=Test2.Tes2t,ou=Test,dc=iconic,dc=com" op="Disable">
                          <Attributes>
                            <Map>
                              <entry key="flow" value="Lifecycle"/>
                              <entry key="interface" value="LCM"/>
                              <entry key="operation" value="Disable"/>
                            </Map>
                          </Attributes>
                        </AccountRequest>
                        <AccountRequest application="HRMS" nativeIdentity="ISIN1005" op="Disable">
                          <Attributes>
                            <Map>
                              <entry key="flow" value="Lifecycle"/>
                              <entry key="interface" value="LCM"/>
                              <entry key="operation" value="Disable"/>
                            </Map>
                          </Attributes>
                        </AccountRequest>
                        <Attributes>
                          <Map>
                            <entry key="identityRequestId" value="0000000048"/>
                            <entry key="requester" value="Operations"/>
                            <entry key="source" value="RapidSetup"/>
                          </Map>
                        </Attributes>
                        <Requesters>
                          <Reference class="sailpoint.object.Identity" name="Operations"/>
                        </Requesters>
                      </ProvisioningPlan>
                    </MasterPlan>
                    <ProvisioningPlan nativeIdentity="ISIN1005" targetIntegration="Active Directory" trackingId="6c31b1bb1fb74f2d98ab85ca22de6228">
                      <AccountRequest application="Active Directory" nativeIdentity="cn=Test2.Tes2t,ou=Test,dc=iconic,dc=com" op="Disable" targetIntegration="Active Directory">
                        <Attributes>
                          <Map>
                            <entry key="flow" value="Lifecycle"/>
                            <entry key="interface" value="LCM"/>
                            <entry key="operation" value="Disable"/>
                            <entry key="provisioningTransactionId" value="0a00030f90001de781900091233f00b9"/>
                          </Map>
                        </Attributes>
                        <AttributeRequest displayValue="ICONIC\Domain Users" name="memberOf" op="Remove" value="CN=Domain Users,CN=Users,DC=iconic,DC=com">
                          <Attributes>
                            <Map>
                              <entry key="assignment" value="true"/>
                            </Map>
                          </Attributes>
                          <ProvisioningResult status="failed">
                            <Errors>
                              <Message key="Failed to update attribute memberOf Error occurred while setting group membership CN=Domain Users,CN=Users,DC=iconic,DC=com. The server is unwilling to process the request. 0000055E: SvcErr: DSID-031A1260, problem 5003 (WILL_NOT_PERFORM), data 0 . HRESULT:[0x80072035]" type="Error"/>
                            </Errors>
                          </ProvisioningResult>
                        </AttributeRequest>
                        <ProvisioningResult status="committed"/>
                      </AccountRequest>
                      <Attributes>
                        <Map>
                          <entry key="identityRequestId" value="0000000048"/>
                          <entry key="requester" value="Operations"/>
                          <entry key="source" value="RapidSetup"/>
                        </Map>
                      </Attributes>
                      <Requesters>
                        <Reference class="sailpoint.object.Identity" name="Operations"/>
                      </Requesters>
                    </ProvisioningPlan>
                    <ProvisioningPlan trackingId="2d6ad149dbb745c5a921052defbc8606">
                      <AccountRequest application="HRMS" nativeIdentity="ISIN1005" op="Disable">
                        <Attributes>
                          <Map>
                            <entry key="flow" value="Lifecycle"/>
                            <entry key="interface" value="LCM"/>
                            <entry key="operation" value="Disable"/>
                          </Map>
                        </Attributes>
                      </AccountRequest>
                      <Attributes>
                        <Map>
                          <entry key="identityRequestId" value="0000000048"/>
                          <entry key="requester" value="Operations"/>
                          <entry key="source" value="RapidSetup"/>
                        </Map>
                      </Attributes>
                      <Requesters>
                        <Reference class="sailpoint.object.Identity" name="Operations"/>
                      </Requesters>
                    </ProvisioningPlan>
                  </ProvisioningProject>
                </value>
              </entry>
              <entry key="requesterEmailTemplate" value="LCM Requester Notification"/>
              <entry key="requireCommentsForApproval" value="false"/>
              <entry key="requireCommentsForDenial" value="false"/>
              <entry key="requireViolationReviewComments" value="true"/>
              <entry key="saveUnmanagedPlan_WithProjectArgument" value="true"/>
              <entry key="securityOfficerElectronicSignature"/>
              <entry key="securityOfficerEmailTemplate"/>
              <entry key="securityOfficerName"/>
              <entry key="sessionOwner" value="Operations"/>
              <entry key="setPreviousApprovalDecisions" value="false"/>
              <entry key="source" value="RapidSetup"/>
              <entry key="splitApprovalSet"/>
              <entry key="splitPlans"/>
              <entry key="splitProjects"/>
              <entry key="splitWorkItemComments"/>
              <entry key="ticketId"/>
              <entry key="ticketManagementApplication"/>
              <entry key="userEmailTemplate" value="LCM User Notification"/>
              <entry key="violationReviewDecision"/>
              <entry key="workItemComments"/>
              <entry key="workItemPriority" value="Normal"/>
            </Map>
          </Attributes>
        </Workflow>
      </WorkflowCase>
    </Step>
    <Step action="sendEmail" icon="Default" name="Notify Manager" posX="829" posY="176">
      <Arg name="plan" value="ref:immediatePlan"/>
      <Arg name="to">
        <Script>
          <Source>
              
                    sailpoint.rapidsetup.tools.EmailTools.getIdentityNameForNotification(context, workflow,
                              identityName, project, true);
                
            </Source>
        </Script>
      </Arg>
      <Arg name="template">
        <Script>
          <Source>
              
                    if(isTerminateIdentity) {
                        return sailpoint.object.RapidSetupConfigUtils.getString("businessProcesses,terminate,email,terminateCompleted");
                    } else {
                        return sailpoint.object.RapidSetupConfigUtils.getString("businessProcesses,leaver,email,leaverCompleted");
                    }
                
            </Source>
        </Script>
      </Arg>
      <Arg name="refIdentityDisplayName">
        <Script>
          <Source>
              
                    sailpoint.rapidsetup.tools.EmailTools.getIdentityDisplayName(context, identityName);
                
            </Source>
        </Script>
      </Arg>
      <Arg name="recipientDisplayName">
        <Script>
          <Source>
              
                    sailpoint.rapidsetup.tools.EmailTools.getManagerOrAltIdentityDisplayName(context, identityName);
                
            </Source>
        </Script>
      </Arg>
      <Arg name="disableStaticManagerContent">
        <Script>
          <Source>
              
                    sailpoint.object.RapidSetupConfigUtils.getBoolean("email,disableStaticManagerContent");
                
            </Source>
        </Script>
      </Arg>
      <Arg name="provisioningErrors">
        <Script>
          <Source>
                
                    sailpoint.rapidsetup.tools.EmailTools.getProvisioningErrors(context, project);
                
            </Source>
        </Script>
      </Arg>
      <Transition to="Refresh Identity Links"/>
    </Step>
    <Step action="call:repairIdentity" name="Refresh Identity Links" posX="983" posY="315">
      <Arg name="identityName" value="ref:identityName"/>
      <Arg name="plan" value="ref:immediatePlan"/>
      <Transition to="Get Deferred Plan Builder"/>
    </Step>
    <Step action="call:getLeaverPlanBuilder" name="Get Deferred Plan Builder" posX="846" posY="488" resultVariable="deferredLeaverPlanBuilder">
      <Arg name="birthrightRoles" value="ref:birthrightRoles"/>
      <Arg name="identityName" value="ref:identityName"/>
      <Arg name="requestType" value="ref:requestType"/>
      <Arg name="reasonComments" value="ref:reasonComments"/>
      <Transition to="Build Deferred Plan"/>
    </Step>
    <Step name="Build Deferred Plan" posX="1020" posY="487" resultVariable="deferredPlans">
      <Script>
        <Source>
                
                return deferredLeaverPlanBuilder.buildDeferredPlans();
                
            </Source>
      </Script>
      <Transition to="Extract Deferred Pam Plans"/>
    </Step>
    <Step name="Extract Deferred Pam Plans" posX="1050" posY="606" resultVariable="deferredPamPlans">
      <Arg name="deferredPlans" value="ref:deferredPlans"/>
      <Script>
        <Source>
                
                    return deferredLeaverPlanBuilder.extractDeferredPamPlans(deferredPlans);
                
            </Source>
      </Script>
      <Transition to="Schedule Deferred Pam Plan"/>
    </Step>
    <Step action="call:executeLeaverPamDeferActions" name="Schedule Deferred Pam Plan" posX="1063" posY="430">
      <Arg name="noTriggers" value="true"/>
      <Arg name="approvalScheme" value="ref:approvalScheme"/>
      <Arg name="identityName" value="ref:identityName"/>
      <Arg name="notificationScheme" value="ref:notificationScheme"/>
      <Arg name="workflow" value="PAM Identity Provisioning"/>
      <Arg name="requestType" value="ref:requestType"/>
      <Arg name="isTerminateIdentity" value="ref:isTerminateIdentity"/>
      <Arg name="reasonComments" value="ref:reasonComments"/>
      <Arg name="source" value="ref:source"/>
      <Arg name="policyScheme" value="ref:policyScheme"/>
      <Arg name="appPlans" value="ref:deferredPamPlans"/>
      <Arg name="flow" value="ref:flow"/>
      <Arg name="deferredPlans" value="ref:deferredPlans"/>
      <Arg name="deferredPamPlans" value="ref:deferredPamPlans"/>
      <Transition to="Schedule Deferred Plan" when="script:(deferredPlans != null &amp;&amp; !deferredPlans.isEmpty())"/>
      <Transition to="Execute Leaver Post Rule"/>
    </Step>
    <Step action="call:executeLeaverDeferActions" name="Schedule Deferred Plan" posX="1293" posY="480">
      <Arg name="identityName" value="ref:identityName"/>
      <Arg name="appPlans" value="ref:deferredPlans"/>
      <Arg name="noTriggers" value="true"/>
      <Arg name="flow" value="ref:flow"/>
      <Arg name="workflow" value="LCM Provisioning"/>
      <Arg name="requestType" value="ref:requestType"/>
      <Arg name="reasonComments" value="ref:reasonComments"/>
      <Arg name="approvalScheme" value="ref:approvalScheme"/>
      <Arg name="isTerminateIdentity" value="ref:isTerminateIdentity"/>
      <Arg name="policyScheme" value="ref:policyScheme"/>
      <Arg name="notificationScheme" value="ref:notificationScheme"/>
      <Arg name="source" value="ref:source"/>
      <Transition to="Execute Leaver Post Rule"/>
    </Step>
    <Step action="call:executePostLeaverRule" name="Execute Leaver Post Rule" posX="1340" posY="238">
      <Arg name="identityName" value="ref:identityName"/>
      <Arg name="requestType" value="ref:requestType"/>
      <Arg name="project" value="ref:project"/>
      <Transition to="Stop"/>
    </Step>
    <Step icon="Stop" name="Stop" posX="1338" posY="118"/>
    <Attributes>
      <Map>
        <entry key="approvalScheme" value="none"/>
        <entry key="birthrightRoles"/>
        <entry key="deferredPlans"/>
        <entry key="flow" value="Lifecycle"/>
        <entry key="identityManager" value="ISIN10000"/>
        <entry key="identityName" value="ISIN1005"/>
        <entry key="identityOwnershipMap"/>
        <entry key="immediatePlan">
          <value>
            <ProvisioningPlan>
              <AccountRequest application="Active Directory" nativeIdentity="cn=Test2.Tes2t,ou=Test,dc=iconic,dc=com" op="Modify">
                <AttributeRequest displayValue="ICONIC\Domain Users" name="memberOf" op="Remove" value="CN=Domain Users,CN=Users,DC=iconic,DC=com">
                  <Attributes>
                    <Map>
                      <entry key="assignment" value="true"/>
                    </Map>
                  </Attributes>
                </AttributeRequest>
              </AccountRequest>
              <AccountRequest application="Active Directory" nativeIdentity="cn=Test2.Tes2t,ou=Test,dc=iconic,dc=com" op="Disable">
                <Attributes>
                  <Map>
                    <entry key="flow" value="Lifecycle"/>
                    <entry key="interface" value="LCM"/>
                    <entry key="operation" value="Disable"/>
                  </Map>
                </Attributes>
              </AccountRequest>
              <AccountRequest application="HRMS" nativeIdentity="ISIN1005" op="Disable">
                <Attributes>
                  <Map>
                    <entry key="flow" value="Lifecycle"/>
                    <entry key="interface" value="LCM"/>
                    <entry key="operation" value="Disable"/>
                  </Map>
                </Attributes>
              </AccountRequest>
              <Attributes>
                <Map>
                  <entry key="identityRequestId" value="0000000048"/>
                  <entry key="requester" value="Operations"/>
                  <entry key="source" value="RapidSetup"/>
                </Map>
              </Attributes>
              <Requesters>
                <Reference class="sailpoint.object.Identity" name="Operations"/>
              </Requesters>
            </ProvisioningPlan>
          </value>
        </entry>
        <entry key="isTerminateIdentity">
          <value>
            <Boolean/>
          </value>
        </entry>
        <entry key="launcher" value="Operations"/>
        <entry key="notificationScheme" value="none"/>
        <entry key="ownershipMap"/>
        <entry key="pamPlans"/>
        <entry key="policyScheme" value="none"/>
        <entry key="project"/>
        <entry key="reasonComments"/>
        <entry key="requestName" value="RapidSetup Leaver FOR ISIN1005 1717996425601"/>
        <entry key="requestType" value="leaver"/>
        <entry key="saveUnmanagedPlan_WithProjectArgument" value="true"/>
        <entry key="sessionOwner" value="Operations"/>
        <entry key="source" value="RapidSetup"/>
        <entry key="taskResultId" value="0a00030f90001de7819000911f1700ae"/>
        <entry key="trigger">
          <value>
            <IdentityTrigger handler="sailpoint.api.AsynchronousWorkflowTriggerHandler" name="RapidSetup Leaver" type="RapidSetup">
              <Description>Rapid Setup Leaver processed a lifecycle event.</Description>
              <HandlerParameters>
                <Attributes>
                  <Map>
                    <entry key="businessProcess" value="leaver"/>
                    <entry key="identityProcessingThreshold"/>
                    <entry key="identityProcessingThresholdType"/>
                    <entry key="workflow" value="RapidSetup - Leaver"/>
                  </Map>
                </Attributes>
              </HandlerParameters>
            </IdentityTrigger>
          </value>
        </entry>
      </Map>
    </Attributes>
  </Workflow>
</WorkflowCase>